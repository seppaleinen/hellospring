version: '2'
services:
  consumer:
    container_name: consumer
    build: hellopact-consumer
    image: seppaleinen/hellopact-consumer
    links:
      - producer:producer
    ports:
      - "8080:8080"

  producer:
    container_name: producer
    build: hellopact-producer
    image: seppaleinen/hellopact-producer
    ports:
      - "8082:8082"

  broker_app:
    container_name: pact-broker
    image: dius/pact-broker
    ports:
      - "80:80"
    links:
      - postgres
    environment:
      PACT_BROKER_DATABASE_USERNAME: postgres
      PACT_BROKER_DATABASE_PASSWORD: password
      PACT_BROKER_DATABASE_HOST: postgres
      PACT_BROKER_DATABASE_NAME: postgres

  postgres:
    container_name: postgres
    image: postgres:10-alpine
    ports:
      - "5432:5432"
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
      POSTGRES_DB: postgres

  nginx:
    container_name: nginx
    image: nginx:alpine
    links:
      - broker_app:broker
#    volumes:
#    - ./ssl/nginx.conf:/etc/nginx/conf.d/default.conf:ro
#    - ./ssl:/etc/nginx/ssl
    ports:
    - "8443:443"
